<!DOCTYPE html>
<html lang="ru-RU">

<head>
    <meta charset="UTF-8">
    <title>Добавить карточку</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>

<body>
    <form style="width: 450px; margin: 0 auto;" id="SendForm">
        <h4>Добавить карточку</h4>
        <div class="formel">
            <label for="Name">Наименование*</label>
            <input type="text" class="form-control" id="Name" name="Name" placeholder="Введите имя карточки"
                minlength="9" maxlength="50" required>
        </div>
        <div class="formel">
            <label for="TextS">Краткое описание*</label>
            <textarea type="text" class="form-control" id="TextS" name="TextS" placeholder="Хоть какое-нибудь"
                minlength="10" maxlength="150" required></textarea>
        </div>
        <div class="formel">
            <label for="Text">Описание</label>
            <textarea class="form-control" id="Text" name="Text" maxlength="1500"
                placeholder="Впишите всё, что есть"></textarea>
        </div>
        <input type="file" id="files" name="files" accept=".stl, .obj">
        <div class="formel" style="display: flex;justify-content: space-between;">
            <button type="button" class="btn btn-info" onclick="location.href='/'">Назад</button>
            <button type="submit" class="btn btn-info" id="Send">Добавить</button>
        </div>
    </form>
    <script>
        let uuid = localStorage.getItem('sess_id');
        if (uuid == undefined) uuid = 0;
        document.getElementById("Send").addEventListener("click", function (e) {
            if (document.getElementById("Name").validity.valid
                && document.getElementById("Text").validity.valid
                && document.getElementById("TextS").validity.valid) {
                // 
                e.preventDefault();
                let registerForm = document.forms["SendForm"];
                const formData = new FormData(registerForm);
                formData.append("UUID", uuid);
                const xhr = new XMLHttpRequest();
                xhr.onload = () => {
                    console.log(JSON.parse(xhr.response));
                    //let S = xhr.response.status;
                    // if (S == 0) {
                    //     //успешно отправлено
                    // }
                    // else {
                    //     if (S == 255) console.log("Неизвестная ошибка при отправке.");
                    //     if (S == 1) console.log("Ошибка в базе данных.");
                    //     if (S == 3 | S == 2) console.log("Вы не вошли, у вас нет права на добавление.");
                    //     if (S == 4) console.log("Ошибка в базе данных при добавлении юзерар.");
                    // }
                    window.location = '/';
                };
                xhr.open('POST', "/cards/new");
                xhr.send(formData);
            }
        });
    </script>
</body>

</html>