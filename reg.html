<!DOCTYPE html>
<html lang="ru-RU">

<head>
    <meta charset="UTF-8">
    <title>Зарегестрироваться</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>

<body>
    <form style="width: 450px; margin: 0 auto;" id="SendForm">
        <h4>Зарегестрироваться</h4>
        <div class="formel">
            <label for="Name">ФИО*</label>
            <input type="text" class="form-control" id="Name" name="Name" placeholder="Неизвестно" minlength="9"
                maxlength="50" required>
        </div>
        <div class="formel">
            <label for="Pass">Пароль*</label>
            <input type="text" class="form-control" id="Pass" name="Pass" placeholder="Да подлиннее" minlength="6"
                maxlength="50" required>
        </div>
        <div class="formel">
            <label for="Mail">Почта*</label>
            <input type="email" id="Mail" name="Mail" class="form-control" placeholder="example@gmail.com" required
                minlength="9" maxlength="50">
        </div>
        <div class="formel">
            <label for="Mail2">Дополнительная почта</label>
            <input type="email" id="Mail2" name="Mail2" class="form-control" placeholder="example@gmail.com"
                minlength="9" maxlength="50">
        </div>
        <div class="formel">
            <label for="Info">Информация о вас</label>
            <textarea class="form-control" id="Info" name="Info" placeholder="Информация о вас"></textarea>
        </div>
        <div class="formel">
            <label for="Achiv">Дополнительные достижения</label>
            <textarea class="form-control" id="Achiv" name="Achiv" placeholder="Впишите всё, что есть"></textarea>
        </div>
        <div class="formel" style="display: flex;justify-content: space-between;">
            <button type="button" class="btn btn-info" onclick="location.href='/'">Назад</button>
            <button type="submit" class="btn btn-info" id="Send">Отправить</button>
        </div>
    </form>
    <script>
        document.getElementById("Send").addEventListener("click", function (e) {
            if (document.getElementById("Name").validity.valid
                && document.getElementById("Mail").validity.valid
                && document.getElementById("Mail2").validity.valid
                && document.getElementById("Pass").validity.valid
                && document.getElementById("Info").validity.valid
                && document.getElementById("Achiv").validity.valid) {
                let registerForm = document.forms["SendForm"];
                let Name = registerForm.elements["Name"].value;
                let Mail = registerForm.elements["Mail"].value;
                let Mail2 = registerForm.elements["Mail2"].value;
                let Pass = registerForm.elements["Pass"].value;
                let Info = registerForm.elements["Info"].value;
                let Achiv = registerForm.elements["Achiv"].value;
                let user = JSON.stringify({ Name: Name, Pass: Pass, Mail: Mail, Mail2: Mail2, Info: Info, Achiv: Achiv });
                let request = new XMLHttpRequest();
                request.open("post", "/users/new", true);
                request.setRequestHeader("Content-Type", "application/json");
                request.addEventListener("load", function () {
                    let receivedUser = JSON.parse(request.response);
                    console.log("ответ От new: " + request.response);
                    let S = receivedUser.status;
                    if (S == 0) {
                        //успешно отправлено
                        window.location = '/';
                    }
                    else {
                        if (S == 255) console.log("Неизвестная ошибка при отправке.");
                        if (S == 1) console.log("Ошибка в базе данных.");
                        if (S == 2) console.log("Почта уже есть.");
                    }
                });
                console.log(user);
                request.send(user);
                e.preventDefault();
            }
        });
    </script>
</body>

</html>