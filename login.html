<!DOCTYPE html>
<html lang="ru-RU">

<head>
    <meta charset="UTF-8">
    <title>Войти</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>

<body>
    <form style="width: 450px; margin: 0 auto;" id="SendForm">
        <h4>Войти</h4>
        <div class="formel">
            <label for="Mail">Почта*</label>
            <input type="email" id="Mail" name="Mail" class="form-control" placeholder="example@gmail.com" required
                minlength="9" maxlength="50">
        </div>
        <div class="formel">
            <label for="Pass">Пароль*</label>
            <input type="text" class="form-control" id="Pass" name="Pass" placeholder="" minlength="6"
                maxlength="50" required>
        </div>
        <div class="formel" style="display: flex;justify-content: space-between;">
            <button type="button" class="btn btn-info" onclick="location.href='/'">Назад</button>
            <button type="submit" class="btn btn-info" id="Send">Отправить</button>
        </div>
    </form>
    <script>
        let uuid = localStorage.getItem('sess_id');
        if (uuid == undefined) uuid = 0;
        document.getElementById("Send").addEventListener("click", function (e) {
                if (document.getElementById("Mail").validity.valid
                && document.getElementById("Pass").validity.valid) {
                //e.preventDefault();
                //return;
                let registerForm = document.forms["SendForm"];
                let Mail = registerForm.elements["Mail"].value;
                let Pass = registerForm.elements["Pass"].value;
                let user = JSON.stringify({ Pass: Pass, Mail: Mail, UUID: uuid });
                let request = new XMLHttpRequest();
                request.open("post", "/users/login", true);
                request.setRequestHeader("Content-Type", "application/json");
                request.addEventListener("load", function () {
                    let receivedUser = JSON.parse(request.response);
                    console.log("ответ От login: " + request.response);
                    let S = receivedUser.status;
                    if (S == 0) {
                        //успешно отправлено
                        console.log(receivedUser.uuid);
                        localStorage.setItem('sess_id', receivedUser.uuid);
                        console.log(localStorage.getItem('sess_id'));
                        window.location = '/';
                    }
                    else {
                        if (S == 255) console.log("Неизвестная ошибка при отправке.");
                        if (S == 1) console.log("Ошибка в базе данных.");
                        if (S == 2) console.log("Неверное имя пользователя или пароль.");
                    }
                });
                console.log(user);
                request.send(user);
                e.preventDefault();
            }
        });
    </script>
</body>

</html>